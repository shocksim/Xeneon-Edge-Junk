<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <style>
        :root { --blur: 0px; --brightness: 100%; }
        body { margin: 0; font-family: sans-serif; background: #000; height: 100vh; display: flex; align-items: center; justify-content: center; overflow: hidden; }
        
        .widget-container { position: relative; width: 100%; height: 100%; }

        #bg-image { 
            width: 100%; height: 100%; object-fit: cover; 
            filter: brightness(var(--brightness)); 
        }

        /* The Blur Layer */
        .glass-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            backdrop-filter: blur(var(--blur));
            -webkit-backdrop-filter: blur(var(--blur));
            pointer-events: none; /* ESSENTIAL: Allows clicks to pass through to buttons */
            z-index: 5;
        }

        .attribution {
            position: absolute; bottom: 15px; left: 15px;
            color: white; font-size: 11px; z-index: 10;
            text-shadow: 0 1px 4px rgba(0,0,0,0.8);
            background: rgba(0,0,0,0.3); padding: 4px 8px; border-radius: 4px;
        }
        .attribution a { color: #fff; }

        .settings-wrapper { position: absolute; bottom: 15px; right: 15px; z-index: 20; }
        
        .cog-btn {
            background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3);
            cursor: pointer; border-radius: 50%; padding: 10px; backdrop-filter: blur(10px);
        }

        .menu-panel {
            position: absolute; bottom: 60px; right: 0;
            background: rgba(20, 20, 20, 0.9); padding: 15px;
            border-radius: 12px; width: 200px; display: none; color: white;
            border: 1px solid rgba(255,255,255,0.1);
        }
        .menu-panel.active { display: block; }
        
        .control-group { margin-bottom: 12px; }
        label { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; display: block; margin-bottom: 5px; opacity: 0.6; }
        input[type=range] { width: 100%; accent-color: #eee; }

        button#new-img-btn {
            width: 100%; padding: 8px; margin-top: 10px; cursor: pointer;
            background: #fff; border: none; border-radius: 4px; font-weight: bold;
        }
    </style>
</head>
<body>

<div class="widget-container">
    <img id="bg-image" src="https://images.unsplash.com/photo-1470770841072-f978cf4d019e?auto=format&fit=crop&w=1200" alt="Background">
    <div class="glass-overlay"></div>
    
    <div class="attribution">
        Photo by <a id="user-link" target="_blank">Artist</a> on <a id="unsplash-link" target="_blank">Unsplash</a>
    </div>

    <div class="settings-wrapper">
        <div id="menu" class="menu-panel">
            <div class="control-group">
                <label>Brightness</label>
                <input type="range" id="brightRange" min="20" max="120" value="100">
            </div>
            <div class="control-group">
                <label>Blur Intensity</label>
                <input type="range" id="blurRange" min="0" max="12" step="0.5" value="0">
            </div>
            <button id="new-img-btn">Refresh Image</button>
        </div>
        <button class="cog-btn" onclick="toggleMenu()">⚙️</button>
    </div>
</div>

<script>
    // 1. ENTER YOUR KEY HERE
    const ACCESS_KEY = 'YOUR_UNSPLASH_ACCESS_KEY'; 
    const APP_NAME = 'MyGlassWidget';

    const menu = document.getElementById('menu');
    const bgImage = document.getElementById('bg-image');
    const blurSlider = document.getElementById('blurRange');
    const brightSlider = document.getElementById('brightRange');
    const refreshBtn = document.getElementById('new-img-btn');

    function toggleMenu() { menu.classList.toggle('active'); }

    // Live Updates
    blurSlider.addEventListener('input', (e) => {
        document.documentElement.style.setProperty('--blur', e.target.value + 'px');
    });

    brightSlider.addEventListener('input', (e) => {
        document.documentElement.style.setProperty('--brightness', e.target.value + '%');
    });

    // Fix: Explicitly attach event listener to button
    refreshBtn.addEventListener('click', () => {
        console.log("Fetching new image...");
        fetchNewImage();
    });

    async function fetchNewImage() {
        if (ACCESS_KEY === 'YOUR_UNSPLASH_ACCESS_KEY') {
            alert("Please paste your Unsplash Access Key into the script code.");
            return;
        }

        try {
            const utm = `?utm_source=${APP_NAME}&utm_medium=referral`;
            const res = await fetch(`https://api.unsplash.com/photos/random?client_id=${ACCESS_KEY}`);
            const data = await res.json();
            
            bgImage.src = data.urls.regular;
            document.getElementById('user-link').href = data.user.links.html + utm;
            document.getElementById('user-link').innerText = data.user.name;
            document.getElementById('unsplash-link').href = "https://unsplash.com/" + utm;
        } catch (err) {
            console.error("Fetch failed:", err);
        }
    }
</script>
</body>
</html>
